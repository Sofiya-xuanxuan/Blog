# 测试
## 测试分类
常⻅见的开发流程⾥里里，都有测试⼈人员，这种我们称为⿊黑盒测试，测试⼈人员不不管内部实现机制，只看最外层的输⼊入输出，⽐比如你写⼀一个加法的⻚页⾯面，会设计N个case，测试加法的正确性，这种代码⾥里里，我们称之为**E2E测试**。

更更负责⼀一些的 我们称之为**集成测试**，就是集合多个测试过的单元⼀一起测试。
还有⼀一种测试叫做⽩白盒测试，我们针对⼀一些内部机制的核⼼心逻辑 使⽤用代码 进⾏行行编写 我们称之为**单元测试**。

## 准备工作
推荐⽤用使⽤用Jest作为测试框架

新建vue项⽬目，⼿手动选择特性，添加Unit Testing和E2E Testing

单元测试解决⽅方案选择：Jest

端到端测试解决⽅方案选择：Cypress

## 单元测试
单元测试（unit testing），是指对软件中的最⼩小可测试单元进⾏行行检查和验证。

新建test/unit/kaikeba.spec.js， *.spec.js 是命名规范，写下⼀一下代码
```
function add(num1, num2) {
return num1 + num2
}
// 测试套件 test suite
describe('Kaikeba', () => {
// 测试⽤用例例 test case
it('测试add函数', () => {
// 断⾔言 assert
expect(add(1, 3)).toBe(3)
expect(add(1, 3)).toBe(4)
expect(add(-2, 3)).toBe(1)
})
})
```
>这⾥里里⾯面仅演示了了toBe，更更多断⾔言API

## 执⾏单元测试
```
npm run test:unit
```
## 测试Vue组件
- 创建⼀一个vue组件components/Kaikeba.vue
```
<template>
    <div>
    <span>{{ message }}</span>
    <button @click="changeMsg">点击</button>
    </div>
</template>
<script>
export default {
    data () {
        return {
            message: 'vue-text'
        }
    },
    created () {
        this.message = '开课吧'
    },
    methods:{
        changeMsg(){
            this.message = '按钮点击'
        }
    }
}
</script>
```
- 测试该组件
```
// 导⼊入 Vue.js 和组件，进⾏行行测试
import Vue from 'vue'
import KaikebaComp from '@/components/Kaikeba.vue'
describe('KaikebaComp', () => {
    // 检查原始组件选项
    it('由created⽣生命周期', () => {
        expect(typeof KaikebaComp.created).toBe('function')
    })
    // 评估原始组件选项中的函数的结果
    it('初始data是vue-text', () => {
        // 检查data函数存在性
        expect(typeof KaikebaComp.data).toBe('function')
        // 检查data返回的默认值
        const defaultData = KaikebaComp.data()
        expect(defaultData.message).toBe('hello!')
    })
})
```
- 检查mounted之后
```
it('mount之后测data是开课吧', () => {
const vm = new Vue(KaikebaComp).$mount()
expect(vm.message).toBe('开课吧')
})
```
- 用户点击
和写vue没啥本质区别，只不不过我们⽤用测试的⻆角度去写代码，vue提供了了专⻔门针对测试的 @vue/test-utils
```
import { mount } from '@vue/test-utils'
it("按钮点击后", () => {
const wrapper = mount(KaikebaComp);
wrapper.find("button").trigger("click");
// 测试数据变化
expect(wrapper.vm.message).toBe("按钮点击");
// 测试html渲染结果
expect(wrapper.find("span").html()).toBe("<span>按钮点击</span>");
// 等效的⽅方式
expect(wrapper.find("span").text()).toBe("按钮点击");
});
```
- 测试覆盖率
jest⾃自带覆盖率，package.json⾥里里修改jest配置
```
"jest": {
    "collectCoverage": true,
    "collectCoverageFrom": ["src/**/*.{js,vue}"],
}
```
>若采⽤用独⽴立配置，则修改jest.config.js:
```
module.exports = {
    ...
    "collectCoverage": true,
    "collectCoverageFrom": ["src/**/*.{js,vue}"]
}
```
>在此执⾏行行npm run test:unit

[Vue组件单元测试cookbook](https://cn.vuejs.org/v2/cookbook/unit-testing-vue-components.html)

[Vue Test Utils使⽤用指南](https://vue-test-utils.vuejs.org/zh/)


##  E2E测试
借⽤用浏览器器的能⼒力力，站在⽤用户测试⼈人员的⻆角度，输⼊入框，点击按钮等，完全模拟⽤用户，这个和具体的框架关系不不⼤大，完全模拟浏览器器⾏行行为。
- 运⾏行行E2E测试
```
npm run test:e2e
```
修改e2e/spec/test.js
```
// https://docs.cypress.io/api/introduction/api.html
describe('端到端测试，抢测试⼈人员的饭碗', () => {
    it('先访问⼀一下', () => {
    cy.visit('/')
    // cy.contains('h1', 'Welcome to Your Vue.js App')
    cy.contains('span', '开课吧')
    })
})
```
测试未通过，因为没有使⽤用Kaikeba.vue，修改App.vue
```
<div id="app">
<img alt="Vue logo" src="./assets/logo.png">
<!-- <HelloWorld msg="Welcome to Your Vue.js App"/> -->
<Kaikeba></Kaikeba>
</div>
import Kaikeba from './components/Kaikeba.vue'
export default {
    name: 'app',
    components: {
    HelloWorld,Kaikeba
}
}
```
- 测试⽤用户点击
```
// https://docs.cypress.io/api/introduction/api.html
describe('端到端测试，抢测试⼈人员的饭碗', () => {
    it('先访问⼀一下', () => {
        cy.visit('/')
        // cy.contains('h1', 'Welcome to Your Vue.js App')
        cy.contains('#message', '开课吧')
        cy.get('button').click()
        cy.contains('span', '按钮点击')
    })
})
```